@using ClipLazor.Components;
@inject IClipLazor Clipboard
@inject ISnackbar _snackbar
@inject Services.SchedulePersonPdf escalaPessoaPdf
@inject Services.PDFSchedule pDFEscala


<MudDialog>
    <TitleContent>
        <MudText Typo="Typo.h3">Escala pessoal</MudText>
    </TitleContent>
    <DialogContent>
        <MudPaper Style="width: 100%">
            <MudStepper OnPreviewInteraction="OnPreviewInteraction">
               
                <MudStep Style="width:100%; padding-left: 5px; padding-right: 5px;" Title="Selecione a pessoa">
                    <EPSelectName Names="Names" NameChanged="OnOk" />
                   
                </MudStep>
                <MudStep Title="Ação" Style="width:100%; padding-left: 5px; padding-right: 5px;">
                    <EPView Mes="Month" Ano="Year" Nome="@Nome" DiasAndFuncao="DiasAndFuncao" Disabled="@(!isCompleted)" />
                </MudStep>
            </MudStepper>
        </MudPaper>

    </DialogContent>
    <DialogActions>
        <MudButton OnClick="OnClose" Variant="Variant.Text" Color="Color.Default">Fechar</MudButton>
    </DialogActions>

</MudDialog>



@code {

    [CascadingParameter]
    IMudDialogInstance MudDialog { get; set; } = null!;

    [Parameter]
    public List<string> Names { get; set; }

    [Parameter]
    public int Month { get; set; }
    [Parameter]
    public int Year { get; set; }

    [Parameter]
    public required View.ScheduleTypeView[] EscalaTipos { get; set; }

    bool isCompleted { get; set; } = false;
    string? MesNome => Utils.DateTimeUtil.GetMonthName(Month);
    string Nome { get; set; } = string.Empty;
    IEnumerable<(string? Name, byte Dia, string PersonName)>? DiasAndFuncao => View.ScheduleTypeView.GetDays(EscalaTipos, Nome);
    void OnOk(string nome)
    {
        Nome = nome;
    }
    void OnClose()
    {
        MudDialog.Close();
    }

    private async Task OnPreviewInteraction(StepperInteractionEventArgs arg)
    {
        
        isCompleted = arg.Action == StepAction.Complete && arg.StepIndex == 1;
        if (isCompleted) StateHasChanged();
    }
}
